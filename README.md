# Broken Hand (bh) 語言直譯器

## 組員
鍾承翰  
蔡昌諭  
陳顥勻  
張力之

---

## 簡介
Broken Hand (bh) 是一個符號化設計的直譯式程式語言，支援基本運算、邏輯運算、流程控制、函式、switch-case、多層作用域、註解、型別自動轉換與錯誤提示。

---

## 語法支援一覽

- **數值型別**：整數、浮點數
- **布林型別**：`T`（True）、`F`（False）
- **字串型別**：用雙引號，如 `"Hello"`
- **變數指派**：`x = 10`
- **輸出**：`p 表達式`
- **四則與邏輯運算**：
    - 加法：`+`（支援型別自動轉換，例 `"abc" + 123` 得 `abc123`）
    - 減法：`-`
    - 乘法：`*`
    - 除法：`/`
    - 取餘數：`%`
    - 比較：`==`, `!=`, `<`, `>`, `<=`, `>=`
    - 邏輯：`&&`, `||`, `!`
- **條件判斷 if-else**：`? (條件) { ... } ~ { ... }`
- **while 迴圈**：`@ (條件) { ... }`
- **for 迴圈**：`$ (初始; 條件; 更新) { ... }`
- **break/continue**：
    - `<<` 跳出當前迴圈（break）
    - `>>` 跳到下個迴圈（continue）
- **switch-case 條件選擇**：
    - `^ (表達式) { | 值: { ... } ... _: { ... } }`
    - `|` 表示 case，`_` 表示 default
- **函式定義與呼叫**：
    - 定義：`f 函式名(參數...) { ... }`
    - 回傳：`r 表達式`
- **作用域**：
    - 全域變數
    - 區域變數（函式內宣告的變數僅在該函式可見）
- **註解**：行首 `#` 為註解
- **錯誤提示**：所有語法錯誤都會標示「第幾行、第幾字元」
- **型別自動轉換**：`+` 碰到字串自動拼接

---

## 語法符號一覽

| 功能       | 符號     |
|----------|--------|
| if       | `?`    |
| else     | `~`    |
| while    | `@`    |
| for      | `$`    |
| switch   | `^`    |
| case     | `\|`   |
| default  | `_`    |
| print    | `p`    |
| function | `f`    |
| return   | `r`    |
| break    | `<<`   |
| continue | `>>`   |
| not      | `!`    |
| and      | `&&`   |
| mod      | `%`    |
| or       | `\|\|` |
| 註解       | `#`    |

---

## 語法範例

### 基本運算與變數

```bh
a = 5
b = 2
p a + b           # 輸出 7
p "值為" + a      # 輸出 值為5
````

### if-else

```bh
? (a > 0) {
    p "正數"
} ~ {
    p "非正數"
}
```

### while 迴圈

```bh
i = 0
@ (i < 3) {
    p i
    i = i + 1
}
```

### for 迴圈

```bh
$ (j = 1; j <= 3; j = j + 1) {
    p j
}
```

### break 與 continue

```bh
$ (i = 0; i < 5; i = i + 1) {
    ? (i == 2) {
        >>     # continue
    }
    ? (i == 4) {
        <<     # break
    }
    p i
}
```

### switch-case

```bh
t = 2
^ (t) {
    | 1: {
        p "one"
    }
    | 2: {
        p "two"
    }
    _: {
        p "not one or two"
    }
}
```

### 函式、區域與全域變數

```bh
x = 10

f change_x(a) {
    x = a
    p "函式內 x:" + x
}

change_x(100)
p "全域 x:" + x     # 如果作用域正確，這裡 x 仍為 10

f local_test() {
    z = 77
    p "local z:" + z
}
local_test()
# p z   # 這裡 z 在全域不可見，會錯
```

### 邏輯運算、布林

```bh
b1 = T
b2 = F
? (b1 && !b2) {
    p "邏輯運算通過"
} ~ {
    p "邏輯運算失敗"
}
```

### 註解

```bh
# 這是一行註解
```

---

## 執行方式

1. 確認已安裝 Python 3.x
2. 將程式存成 `.bh` 檔案
3. 執行指令：

   ```bash
   python main.py yourcode.bh
   ```
   把yourcode改成你要執行的bh檔案名稱

---

## 檔案說明

* **main.py** — 執行進入點
* **lexer.py** — 詞法分析
* **parser.py** — 語法分析
* **ast.py** — 抽象語法樹
* **interpreter.py** — 程式執行解釋器
* **env.py** — 變數與作用域管理
* **error.py** — 例外與錯誤處理
* **test.bh** — 語法範例程式